### MNAP

$$
MNAP@20 = \dfrac{1}{|U|} \sum_{u \in U} \dfrac{1}{\min (n_u, 20)} \sum_{i=1}^{20} r_u(i)\, p_u@i, \quad p_u@k = \dfrac{1}{k}\sum_{i=1}^k r_u(i),
$$
где $r_u(i)$ -- потребил ли пользователь $u$ контент, предсказанный ему на месте $i$ (1 или 0), $n_u$ --  количество элементов, которые пользователь потребил за тестовый период, $U$ -- множество тестовых пользователей.

Метрика отличается от оригинальной MAP тем, что значение для каждого пользователя нормализуется не на константу, а на число потребленных фильмов. Таким образом, вес угадывания одного фильма больше у пользователей, имеющих меньшее число просмотров. 

Подробнее про метрики ранжирования на [Хабр](https://habr.com/ru/companies/econtenta/articles/303458/).

